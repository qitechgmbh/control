Index: machines/src/registry.rs
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>#[cfg(feature = \"mock-machine\")]\nuse crate::{extruder1::mock::ExtruderV2, mock::MockMachine, winder2::mock::Winder2};\n\nuse crate::{Machine, MachineNewParams, machine_identification::MachineIdentification};\n#[cfg(not(feature = \"mock-machine\"))]\nuse crate::{\n    aquapath1::AquaPathV1, buffer1::BufferV1, extruder1::ExtruderV2, laser::LaserMachine,\n    winder2::Winder2, ethercat_beckhoff::BeckhoffMachine,\n};\n\nuse lazy_static::lazy_static;\n\nuse anyhow::Error;\nuse std::{any::TypeId, collections::HashMap};\n\n\n\npub type MachineNewClosure =\n    Box<dyn Fn(&MachineNewParams) -> Result<Box<dyn Machine>, Error> + Send + Sync>;\n\npub struct MachineRegistry {\n    type_map: HashMap<TypeId, (MachineIdentification, MachineNewClosure)>,\n}\n\nimpl Default for MachineRegistry {\n    fn default() -> Self {\n        Self::new()\n    }\n}\n\nimpl MachineRegistry {\n    pub fn new() -> Self {\n        Self {\n            type_map: HashMap::new(),\n        }\n    }\n\n    pub fn register<T: Machine + 'static>(\n        &mut self,\n        machine_identficiation: MachineIdentification,\n    ) {\n        self.type_map.insert(\n            TypeId::of::<T>(),\n            (\n                machine_identficiation.clone(),\n                // create a machine construction closure\n                Box::new(|machine_new_params| Ok(Box::new(T::new(machine_new_params)?))),\n            ),\n        );\n    }\n\n    pub fn new_machine(\n        &self,\n        machine_new_params: &MachineNewParams,\n    ) -> Result<Box<dyn Machine>, anyhow::Error> {\n        // get machiine identification\n        let device_identification =\n            &machine_new_params\n                .device_group\n                .first()\n                .ok_or(anyhow::anyhow!(\n                    \"[{}::MachineConstructor::new_machine] No device in group\",\n                    module_path!()\n                ))?;\n\n        // find machine new function by comparing MachineIdentification\n        let (_, machine_new_closure) = self\n            .type_map\n            .values()\n            .find(|(mi, _)| {\n                mi == &device_identification\n                    .device_machine_identification\n                    .machine_identification_unique\n                    .machine_identification\n            })\n            .ok_or(anyhow::anyhow!(\n                \"[{}::MachineConstructor::new_machine] Machine not found\",\n                module_path!()\n            ))?;\n\n        // call machine new function by reference\n        (machine_new_closure)(machine_new_params)\n    }\n}\n\nlazy_static! {\n    pub static ref MACHINE_REGISTRY: MachineRegistry = {\n        let mut mc = MachineRegistry::new();\n        mc.register::<Winder2>(Winder2::MACHINE_IDENTIFICATION);\n        mc.register::<ExtruderV2>(ExtruderV2::MACHINE_IDENTIFICATION);\n\n        #[cfg(feature = \"mock-machine\")]\n        mc.register::<MockMachine>(MockMachine::MACHINE_IDENTIFICATION);\n\n        #[cfg(not(feature = \"mock-machine\"))]\n        mc.register::<LaserMachine>(LaserMachine::MACHINE_IDENTIFICATION);\n\n        #[cfg(not(feature = \"mock-machine\"))]\n        mc.register::<BufferV1>(BufferV1::MACHINE_IDENTIFICATION);\n\n        // Wir registrieren BufferV1 zus√§tzlich auf die ID 0, 0 (dein Labor-Setup)\n\n        //#[cfg(not(feature = \"mock-machine\"))]\n        //mc.register::<BeckhoffMachine>(BeckhoffMachine::MACHINE_IDENTIFICATION);\n\n        #[cfg(not(feature = \"mock-machine\"))]\n        mc.register::<AquaPathV1>(AquaPathV1::MACHINE_IDENTIFICATION);\n        #[cfg(not(feature = \"mock-machine\"))]\n        mc.register::<BeckhoffMachine>(BeckhoffMachine::MACHINE_IDENTIFICATION);\n        mc\n    };\n}\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/machines/src/registry.rs b/machines/src/registry.rs
--- a/machines/src/registry.rs	(revision 6af2548baf4a97384bea3431e4226299ced548b2)
+++ b/machines/src/registry.rs	(date 1764863547582)
@@ -105,7 +105,6 @@
 
         #[cfg(not(feature = "mock-machine"))]
         mc.register::<AquaPathV1>(AquaPathV1::MACHINE_IDENTIFICATION);
-        #[cfg(not(feature = "mock-machine"))]
         mc.register::<BeckhoffMachine>(BeckhoffMachine::MACHINE_IDENTIFICATION);
         mc
     };
